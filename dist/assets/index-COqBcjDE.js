(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();async function y(e,t){try{const n=await fetch(e,{headers:{Accept:"application/json"}});if(!n.ok)throw new Error(`Bad response: ${n.status}`);return await n.json()}catch(n){return console.warn("Fetch failed, using fallback for:",e,n.message),t}}async function x(){const t=await y("https://bible-api.com/data/web/random",{random_verse:{book:"John",chapter:3,verse:16,text:"For God so loved the world that he gave his one and only Son..."},translation:{name:"World English Bible"}});if(t&&t.random_verse){const n=t.random_verse,r=t.translation?.name||"Unknown";return{reference:`${n.book} ${n.chapter}:${n.verse}`,translation:r,text:n.text.trim()}}return{reference:"John 3:16",translation:"Unknown",text:"Scripture unavailable."}}async function q(){const t=await y("https://random-quotes-freeapi.vercel.app/api/random",{quote:"Be a light. Keep going.",author:"Unknown"});return{text:t.quote??"Be a light. Keep going.",author:t.author??"Unknown"}}async function k(e){const t=(e||"").trim();if(!t||t.toLowerCase()==="unknown")return{title:"Unknown",description:"Author information unavailable.",extract:"No author details found for this quote.",thumbnail:null,url:null};const n=`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(t)}`,r=await y(n,{title:t,description:"Author information unavailable.",extract:"No author details found for this quote.",thumbnail:null,content_urls:null});return{title:r.title||t,description:r.description||"",extract:r.extract||"No author details found for this quote.",thumbnail:r.thumbnail?.source||null,url:r.content_urls?.desktop?.page||null}}function A(e,t){e.innerHTML=`
    <p class="verse-text">‚Äú${t.text}‚Äù</p>
    <p class="verse-meta">${t.reference} ‚Äî <span>${t.translation}</span></p>
  `,e.classList.remove("loading")}function j(e,t){e.innerHTML=`
    <p class="quote-text">‚Äú${t.text}‚Äù</p>
    <p class="quote-meta">‚Äî <span class="quote-author">${t.author}</span></p>

    <div class="quote-actions">
      <button type="button"
        class="author-spotlight-btn"
        data-author="${(t.author||"").replace(/"/g,"&quot;")}"
        aria-expanded="false"
        aria-controls="author-spotlight">
        Author Spotlight
      </button>
    </div>

    <div id="author-spotlight" class="author-spotlight" hidden>
      <div class="author-spotlight-inner">
        <div class="author-avatar loading" aria-hidden="true"></div>
        <div class="author-details">
          <p class="author-title loading">Loading author details‚Ä¶</p>
        </div>
      </div>
    </div>
  `,e.classList.remove("loading")}const B="vv-journal";function f(){try{return JSON.parse(localStorage.getItem(B))??[]}catch{return[]}}function v(e){localStorage.setItem(B,JSON.stringify(e))}function D(){return f().sort((e,t)=>t.createdAt-e.createdAt)}function S({title:e,body:t,tags:n}){const r={id:crypto.randomUUID(),title:e.trim(),body:t.trim(),tags:n.split(",").map(a=>a.trim()).filter(Boolean),createdAt:Date.now(),updatedAt:Date.now()},o=f();return o.push(r),v(o),r}function T(e,t){const n=f(),r=n.findIndex(o=>o.id===e);return r===-1?null:(n[r]={...n[r],...t,updatedAt:Date.now()},v(n),n[r])}function N(e){v(f().filter(t=>t.id!==e))}function b(e){return new Date(e).toLocaleString()}function h(e){const t=D();if(!t.length){e.innerHTML='<p class="muted">No entries yet. Write your first reflection on the Home page.</p>';return}e.innerHTML=t.map(n=>`
    <div class="entry" data-id="${n.id}">
      <h3>${n.title||"(untitled)"}</h3>
      <p class="meta">Created: ${b(n.createdAt)} ‚Ä¢ Updated: ${b(n.updatedAt)}</p>
      ${n.tags?.length?`<p class="meta">Tags: ${n.tags.join(", ")}</p>`:""}
      <p>${n.body.replace(/\n/g,"<br/>")}</p>
      <div class="controls">
        <button data-edit>Edit</button>
        <button data-delete>Delete</button>
      </div>
    </div>
  `).join(""),e.querySelectorAll("[data-delete]").forEach(n=>{n.addEventListener("click",r=>{const o=r.currentTarget.closest(".entry").dataset.id;N(o),h(e)})}),e.querySelectorAll("[data-edit]").forEach(n=>{n.addEventListener("click",r=>{const o=r.currentTarget.closest(".entry"),a=o.dataset.id,s=prompt("New title:",o.querySelector("h3").textContent)??"",c=prompt("New body:",o.querySelector("p:not(.meta)").textContent)??"";T(a,{title:s,body:c}),h(e)})})}const w="vv-dark";function O(e){const t=localStorage.getItem(w)==="1";document.documentElement.classList.toggle("dark",t),e.checked=t,e.addEventListener("change",()=>{const n=e.checked;document.documentElement.classList.toggle("dark",n),localStorage.setItem(w,n?"1":"0")})}const I=new Map;function m(e){const t=document.getElementById("toast");t&&(t.textContent=e,t.classList.add("show"),window.clearTimeout(m._t),m._t=window.setTimeout(()=>t.classList.remove("show"),2200))}function $(){const e=location.hash.replace("#","")||"home";document.querySelectorAll(".view").forEach(n=>n.hidden=!0);const t=document.getElementById(e)||document.getElementById("home");if(t.hidden=!1,t.classList.remove("fade-in"),t.offsetWidth,t.classList.add("fade-in"),t.id==="history"){const n=document.getElementById("entry-list");h(n)}t.id==="journal"&&(C(),document.getElementById("entry-body-journal")?.focus())}window.addEventListener("hashchange",$);document.getElementById("year").textContent=new Date().getFullYear();O(document.getElementById("dark-mode-toggle"));const p="vv-draft";function _(e=""){const t=String(e).trim();return t?t.split(/\s+/).length:0}function u(){const e=document.getElementById("entry-body-journal"),t=document.getElementById("journal-word-count");!e||!t||(t.textContent=`${_(e.value)} words`)}function C(){const e=document.getElementById("entry-title-journal"),t=document.getElementById("entry-body-journal"),n=document.getElementById("entry-tags-journal");if(!(!e||!t||!n)){try{const r=localStorage.getItem(p);if(!r)return;const o=JSON.parse(r);e.value=o.title||"",t.value=o.body||"",n.value=o.tags||""}catch{}u()}}function g(){window.clearTimeout(g._t),g._t=window.setTimeout(()=>{const e=document.getElementById("entry-title-journal")?.value||"",t=document.getElementById("entry-body-journal")?.value||"",n=document.getElementById("entry-tags-journal")?.value||"";localStorage.setItem(p,JSON.stringify({title:e,body:t,tags:n}))},250)}(async function(){const t=document.getElementById("daily-verse"),n=document.getElementById("daily-quote"),r=await x(),o=await q();A(t,r),j(n,o);const a=n.querySelector(".author-spotlight-btn"),s=n.querySelector("#author-spotlight");a&&s&&a.addEventListener("click",async()=>{if(a.getAttribute("aria-expanded")==="true"){a.setAttribute("aria-expanded","false"),s.hidden=!0;return}a.setAttribute("aria-expanded","true"),s.hidden=!1;const l=a.dataset.author||"Unknown";let i=I.get(l);i||(i=await k(l),I.set(l,i));const E=s.querySelector(".author-details"),d=s.querySelector(".author-avatar");E&&(E.innerHTML=`
          <p class="author-title"><strong>${i.title}</strong>${i.description?` ‚Äî <span>${i.description}</span>`:""}</p>
          <p class="author-extract">${i.extract}</p>
          ${i.url?`<p class="author-link"><a href="${i.url}" target="_blank" rel="noopener noreferrer">Read more on Wikipedia</a></p>`:""}
        `),d&&(d.classList.remove("loading"),i.thumbnail?d.innerHTML=`<img src="${i.thumbnail}" alt="Portrait of ${i.title}" loading="lazy" />`:d.innerHTML='<span class="avatar-fallback" aria-hidden="true">üë§</span>')})})();document.getElementById("entry-form").addEventListener("submit",e=>{e.preventDefault();const t=document.getElementById("entry-title").value,n=document.getElementById("entry-body").value,r=document.getElementById("entry-tags").value;S({title:t,body:n,tags:r}),e.target.reset(),m("Entry saved ‚úÖ"),location.hash="history"});const L=document.getElementById("entry-form-journal");if(L){const e=document.getElementById("entry-body-journal"),t=document.getElementById("entry-title-journal"),n=document.getElementById("entry-tags-journal"),r=()=>{u(),g()};t?.addEventListener("input",r),e?.addEventListener("input",r),n?.addEventListener("input",r),document.getElementById("clear-draft-btn")?.addEventListener("click",()=>{localStorage.removeItem(p),window.setTimeout(u,0)}),L.addEventListener("submit",a=>{a.preventDefault();const s=t?.value||"",c=e?.value||"",l=n?.value||"";S({title:s,body:c,tags:l}),localStorage.removeItem(p),a.target.reset(),u(),m("Entry saved ‚úÖ")})}$();
